document.addEventListener('DOMContentLoaded', function() {
    // Debug: Confirm script is loading
    console.log("Script loaded - adding event listeners");
    
    // Add to Cart functionality
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('add-to-cart')) {
            const button = e.target;
            const productCard = button.closest('.product-card');
            
            // Debug: Check if product card is found
            console.log("Add to Cart clicked", productCard);
            
            if (!productCard) {
                console.error("Product card not found!");
                return;
            }

            try {
                const productData = {
                    id: parseInt(productCard.dataset.id),
                    name: productCard.querySelector('h3').textContent.trim(),
                    price: parseFloat(
                        productCard.querySelector('.product-price')
                        .textContent.replace('₹', '').replace(',', '')
                    ),
                    size: productCard.querySelector('.size-select').value,
                    quantity: parseInt(productCard.querySelector('.quantity-select').value),
                    image: productCard.querySelector('.product-image').src,
                    category: productCard.dataset.category || 'nonveg'
                };

                // Debug: Show extracted data
                console.log("Product data:", productData);

                // Verify addToCart exists
                if (typeof addToCart !== 'function') {
                    console.error("addToCart is not a function!");
                    alert("Cart system not loaded. Please refresh the page.");
                    return;
                }

                addToCart({
                    productId: productData.id,
                    name: productData.name,
                    price: productData.price,
                    size: productData.size,
                    quantity: productData.quantity,
                    image: productData.image,
                    category: productData.category
                });

                // Visual feedback
                button.textContent = '✓ Added!';
                button.disabled = true;
                setTimeout(() => {
                    button.textContent = 'Add to Cart';
                    button.disabled = false;
                }, 2000);

            } catch (error) {
                console.error("Error adding to cart:", error);
                alert("Error adding item. Please check console for details.");
            }
        }
    });

    // Size selector price updates
    document.querySelectorAll('.size-select').forEach(select => {
        select.addEventListener('change', function() {
            const priceElement = this.closest('.product-card').querySelector('.product-price');
            const newPrice = this.options[this.selectedIndex].dataset.price;
            priceElement.textContent = `₹${newPrice}`;
        });
    });
});
